# Symbol Wallet Service - 要件定義

## プロジェクト概要

ユーザーアカウント作成時に自動的にSymbolブロックチェーンのウォレットを生成し、デポジットウォレットから1 XYMを自動送信するWebサービス。

## ビジネス要件

### BR-001: ウォレット自動生成
- ユーザーがアカウントを作成すると、自動的にSymbolウォレットが生成される
- 各ユーザーは1つのウォレットを持つ
- ウォレット情報（アドレス、公開鍵、秘密鍵）はデータベースに保存される

### BR-002: 初期資金の自動送信
- ウォレット作成時に、デポジットウォレットから新規ウォレットに1 XYMが自動送信される
- トランザクションはSymbol testnetで実行される
- 送信失敗時はエラーを返す

### BR-003: ウォレット情報の管理
- ユーザーは自分のウォレット情報を確認できる
- 秘密鍵は通常は非表示で、明示的に表示を要求した場合のみ表示される
- ウォレット情報はユーザーIDで管理される

## 機能要件

### FR-001: ウォレット作成API
**エンドポイント:** `POST /wallet/create`

**リクエスト:**
```json
{
  "user_id": 1
}
```

**レスポンス（成功）:**
```json
{
  "success": true,
  "message": "ウォレットが作成され、1 XYMが送信されました",
  "wallet": {
    "address": "TBXXX...",
    "public_key": "XXX..."
  }
}
```

**レスポンス（失敗）:**
```json
{
  "success": false,
  "message": "エラーメッセージ"
}
```

### FR-002: ウォレット情報取得API（公開情報）
**エンドポイント:** `GET /wallet/{user_id}`

**レスポンス:**
```json
{
  "success": true,
  "wallet": {
    "address": "TBXXX...",
    "public_key": "XXX..."
  }
}
```

### FR-003: ウォレット情報取得API（秘密鍵含む）
**エンドポイント:** `GET /wallet/{user_id}/export`

**レスポンス:**
```json
{
  "success": true,
  "wallet": {
    "address": "TBXXX...",
    "public_key": "XXX...",
    "private_key": "XXX..."
  }
}
```

### FR-004: Webインターフェース
- ユーザーIDを入力してウォレットを作成できる
- 作成されたウォレット情報を表示する
- 秘密鍵はモーダルで表示する（警告メッセージ付き）
- Symbol Explorerへのリンクを提供する
- ワンクリックでアドレス・公開鍵・秘密鍵をコピーできる

## 非機能要件

### NFR-001: パフォーマンス
- ウォレット作成は10秒以内に完了する
- トランザクション送信は5秒以内に完了する（承認は除く）
- API応答時間は1秒以内

### NFR-002: セキュリティ
- 秘密鍵はデータベースに保存される（本番環境では暗号化推奨）
- デポジットウォレットの秘密鍵は環境変数で管理される
- 秘密鍵は.gitignoreに含まれる

### NFR-003: 可用性
- サービスは24時間稼働する
- Symbol testnetの障害時はエラーを返す

### NFR-004: 拡張性
- 複数ユーザーに対応する
- ユーザーIDは整数型で管理される
- データベースはSQLiteを使用する

## 制約事項

### C-001: ネットワーク
- Symbol testnetを使用する
- メインネットへの切り替えは環境変数で可能

### C-002: 技術スタック
- PHP 8.1以上
- Node.js 18以上
- Symbol SDK v2.0.4
- SQLite3

### C-003: 環境
- WSL (Windows Subsystem for Linux) 推奨
- Linux/Mac環境でも動作可能

## 受け入れ基準

### AC-001: ウォレット作成
- [ ] ユーザーIDを指定してウォレットを作成できる
- [ ] 作成されたウォレットはSymbol testnetで有効である
- [ ] アドレス、公開鍵、秘密鍵が正しく生成される
- [ ] ウォレット情報がデータベースに保存される

### AC-002: XYM送信
- [ ] デポジットウォレットから新規ウォレットに1 XYMが送信される
- [ ] トランザクションがSymbol testnetで承認される
- [ ] トランザクションハッシュが返される
- [ ] Symbol Explorerでトランザクションを確認できる

### AC-003: ウォレット情報取得
- [ ] ユーザーIDでウォレット情報を取得できる
- [ ] 公開情報（アドレス、公開鍵）を取得できる
- [ ] 秘密鍵を含む完全な情報を取得できる

### AC-004: Webインターフェース
- [ ] ブラウザでウォレット作成ができる
- [ ] ウォレット情報が表示される
- [ ] 秘密鍵はモーダルで表示される
- [ ] Symbol Explorerへのリンクが機能する
- [ ] コピー機能が動作する

## 用語集

- **Symbol**: ブロックチェーンプラットフォーム
- **XYM**: Symbolのネイティブ通貨
- **ウォレット**: 暗号資産を管理するためのアカウント
- **秘密鍵**: ウォレットを制御するための秘密情報
- **公開鍵**: 秘密鍵から導出される公開情報
- **アドレス**: 公開鍵から導出されるウォレットの識別子
- **トランザクション**: ブロックチェーン上の取引
- **デポジットウォレット**: 初期資金を送信するための共有ウォレット
- **testnet**: テスト用のブロックチェーンネットワーク
- **mainnet**: 本番用のブロックチェーンネットワーク
